<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PepeCards</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* CSS переменные для тем */
        :root {
            /* Светлая тема (по умолчанию) */
            --tg-theme-bg-color: #ffffff;
            --tg-theme-text-color: #000000;
            --tg-theme-hint-color: #999999;
            --tg-theme-link-color: #2481cc;
            --tg-theme-button-color: #40a7e3;
            --tg-theme-button-text-color: #ffffff;
            
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-card: #ffffff;
            --text-primary: #2d3748;
            --text-secondary: #718096;
            --accent-color: #8B5CF6;
            --accent-light: #A78BFA;
            --border-color: #e2e8f0;
            --shadow-color: rgba(0, 0, 0, 0.08);
            --card-back: #8B5CF6;
            --header-bg: rgba(255, 255, 255, 0.95);
            --footer-bg: #ffffff;
            --nav-bg: #ffffff;
            --nav-active: #8B5CF6;
            --nav-inactive: #a0aec0;
            
            /* Редкости */
            --rarity-common: #9ca3af;
            --rarity-rare: #3b82f6;
            --rarity-epic: #8b5cf6;
            --rarity-legendary: #f59e0b;
            --rarity-mythic: #ef4444;
            --rarity-secret: #10b981;
            
            /* Статусы */
            --cooldown-normal: #ef4444;
            --cooldown-vip: #10b981;
            --vip-gradient: linear-gradient(135deg, #f59e0b, #fbbf24);
            --pepepremium-gradient: linear-gradient(135deg, #8b5cf6, #3b82f6, #10b981);
            --rainbow: linear-gradient(90deg, #ef4444, #f59e0b, #10b981, #3b82f6, #8b5cf6);
            
            /* Админ/Премиум */
            --admin-color: #dc2626;
            --premium-color: #8b5cf6;
            
            /* Снег */
            --snow-color: rgba(255, 255, 255, 0.8);
        }

        /* Темно-фиолетовая тема */
        .theme-dark-purple {
            --bg-primary: #1a1a2e;
            --bg-secondary: #16213e;
            --bg-card: #0f3460;
            --text-primary: #e2e8f0;
            --text-secondary: #a0aec0;
            --accent-color: #9d4edd;
            --accent-light: #c77dff;
            --border-color: #2d3748;
            --shadow-color: rgba(0, 0, 0, 0.3);
            --card-back: #9d4edd;
            --header-bg: rgba(26, 26, 46, 0.95);
            --footer-bg: #1a1a2e;
            --nav-bg: #1a1a2e;
            --nav-active: #c77dff;
            --nav-inactive: #718096;
            --snow-color: rgba(255, 255, 255, 0.9);
        }

        /* Ночная тема */
        .theme-night {
            --bg-primary: #0a0a0f;
            --bg-secondary: #121212;
            --bg-card: #1e1e2e;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --accent-color: #7c3aed;
            --accent-light: #a78bfa;
            --border-color: #2d3748;
            --shadow-color: rgba(0, 0, 0, 0.4);
            --card-back: #7c3aed;
            --header-bg: rgba(10, 10, 15, 0.95);
            --footer-bg: #0a0a0f;
            --nav-bg: #0a0a0f;
            --nav-active: #a78bfa;
            --nav-inactive: #64748b;
            --snow-color: rgba(255, 255, 255, 0.9);
        }

        /* Анимации */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        @keyframes shimmer {
            0% { background-position: -200% center; }
            100% { background-position: 200% center; }
        }

        @keyframes cardReveal {
            0% { transform: scale(0.5) rotate(-15deg); opacity: 0; }
            70% { transform: scale(1.1) rotate(5deg); opacity: 1; }
            100% { transform: scale(1) rotate(0); opacity: 1; }
        }

        @keyframes rarityGlow {
            0%, 100% { box-shadow: 0 0 10px currentColor; }
            50% { box-shadow: 0 0 20px currentColor; }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }

        @keyframes confettiFall {
            0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
        }

        @keyframes progressFill {
            from { width: 0%; }
            to { width: var(--progress); }
        }

        @keyframes snowFall {
            0% { transform: translateY(-10px) translateX(0); opacity: 1; }
            100% { transform: translateY(100vh) translateX(20px); opacity: 0; }
        }

        @keyframes snowFall2 {
            0% { transform: translateY(-10px) translateX(0); opacity: 1; }
            100% { transform: translateY(100vh) translateX(-20px); opacity: 0; }
        }

        @keyframes suffixGlow {
            0%, 100% { text-shadow: 0 0 5px currentColor; }
            50% { text-shadow: 0 0 15px currentColor, 0 0 20px currentColor; }
        }

        @keyframes frameGlow {
            0%, 100% { box-shadow: 0 0 10px currentColor; }
            50% { box-shadow: 0 0 20px currentColor, 0 0 30px currentColor; }
        }

        /* Снег на фоне */
        .snow-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }

        .snowflake {
            position: absolute;
            background: var(--snow-color);
            border-radius: 50%;
            pointer-events: none;
        }

        /* Общие стили */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Segoe UI Emoji', sans-serif;
        }

        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.5;
            overflow-x: hidden;
            min-height: 100vh;
            padding-bottom: 70px;
            position: relative;
        }

        /* Экран загрузки */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--accent-color), var(--accent-light));
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            animation: fadeIn 0.3s ease;
        }

        .loading-logo {
            font-size: 3rem;
            margin-bottom: 1.5rem;
            animation: bounce 1s infinite;
        }

        .loading-text {
            color: white;
            font-size: 1rem;
            margin-bottom: 1.5rem;
            text-align: center;
            padding: 0 20px;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* Технический перерыв */
        .maintenance-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9998;
            padding: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .maintenance-content {
            background: var(--bg-card);
            padding: 30px 25px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 90%;
            border: 2px solid var(--accent-color);
        }

        .maintenance-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--accent-color);
        }

        .maintenance-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--text-primary);
        }

        .maintenance-text {
            font-size: 0.95rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        /* Шапка */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: var(--header-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-color);
            z-index: 1000;
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 56px;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--accent-color);
            display: flex;
            align-items: center;
            gap: 6px;
            text-decoration: none;
        }

        .logo-icon {
            animation: bounce 2s infinite;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .coins-display {
            display: flex;
            align-items: center;
            gap: 5px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.85rem;
            border: 1px solid var(--border-color);
            min-width: 100px;
            justify-content: center;
        }

        .coins-display i {
            color: #f59e0b;
        }

        /* Основной контент */
        .main-content {
            margin-top: 56px;
            padding: 16px;
            animation: fadeIn 0.5s ease;
            min-height: calc(100vh - 126px);
            position: relative;
            z-index: 2;
        }

        /* Страницы */
        .page {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .page.active {
            display: block;
        }

        /* Главная страница */
        .main-page {
            padding-top: 5px;
        }

        .greeting {
            margin-bottom: 20px;
            text-align: center;
        }

        .greeting h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
            color: var(--accent-color);
        }

        .greeting p {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .cooldown-section {
            background: linear-gradient(135deg, var(--bg-card), var(--bg-secondary));
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
            text-align: center;
        }

        .cooldown-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-color), var(--accent-light));
        }

        .cooldown-timer {
            font-size: 2.5rem;
            font-weight: 800;
            text-align: center;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            letter-spacing: 1px;
            color: var(--text-primary);
        }

        .cooldown-text {
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .open-card-section {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid var(--border-color);
            margin-bottom: 20px;
            text-align: center;
        }

        .open-card-btn {
            background: linear-gradient(135deg, var(--accent-color), var(--accent-light));
            color: white;
            border: none;
            width: 100%;
            padding: 18px;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .open-card-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(139, 92, 246, 0.4);
        }

        .open-card-btn:active:not(:disabled) {
            transform: translateY(0);
        }

        .open-card-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background: var(--bg-secondary);
            color: var(--text-secondary);
        }

        /* Админ панель */
        .admin-section {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 20px;
            border: 2px solid var(--admin-color);
            margin-bottom: 20px;
            position: relative;
        }

        .admin-section h2 {
            color: var(--admin-color);
            margin-bottom: 15px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .admin-controls {
            display: grid;
            gap: 12px;
        }

        .admin-control-group {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 12px;
        }

        .admin-control-group h3 {
            font-size: 1rem;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .admin-input {
            width: 100%;
            padding: 10px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 0.9rem;
            margin-bottom: 8px;
        }

        .admin-btn {
            width: 100%;
            padding: 10px;
            border-radius: 10px;
            border: none;
            background: var(--admin-color);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .admin-btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .admin-btn.success {
            background: #10b981;
        }

        .admin-player-info {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 15px;
            margin-top: 10px;
            border: 1px solid var(--border-color);
        }

        .admin-player-info h4 {
            color: var(--accent-color);
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .admin-player-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .admin-player-stat {
            background: var(--bg-secondary);
            padding: 8px;
            border-radius: 8px;
            text-align: center;
        }

        .admin-player-stat-value {
            font-weight: 700;
            color: var(--accent-color);
            font-size: 0.9rem;
        }

        .admin-player-stat-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        /* Инвентарь карт */
        .inventory-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .inventory-header h1 {
            font-size: 1.5rem;
            color: var(--accent-color);
        }

        .total-cards {
            background: var(--bg-secondary);
            padding: 6px 12px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.85rem;
            border: 1px solid var(--border-color);
        }

        .filters-container {
            margin-bottom: 15px;
        }

        .filters-scroll {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding-bottom: 8px;
            -webkit-overflow-scrolling: touch;
        }

        .filter-btn {
            padding: 8px 14px;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 0.85rem;
            font-weight: 600;
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .filter-btn:hover {
            border-color: var(--accent-color);
        }

        .filter-btn.active {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        @media (min-width: 768px) {
            .cards-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        .card-item {
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            background: var(--bg-card);
            box-shadow: 0 4px 12px var(--shadow-color);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
        }

        .card-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px var(--shadow-color);
        }

        .card-item.favorite {
            border-color: #f59e0b;
        }

        .card-image {
            height: 140px;
            background-size: cover;
            background-position: center;
            background-color: var(--bg-secondary);
        }

        .card-info {
            padding: 12px;
            position: relative;
        }

        .card-name {
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 6px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .card-rarity {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 700;
            margin-bottom: 6px;
        }

        .rarity-common .card-rarity {
            background: var(--rarity-common);
            color: white;
        }

        .rarity-rare .card-rarity {
            background: var(--rarity-rare);
            color: white;
        }

        .rarity-epic .card-rarity {
            background: var(--rarity-epic);
            color: white;
        }

        .rarity-legendary .card-rarity {
            background: var(--rarity-legendary);
            color: white;
            animation: rarityGlow 2s infinite;
        }

        .rarity-mythic .card-rarity {
            background: var(--rarity-mythic);
            color: white;
            animation: rarityGlow 1.5s infinite;
        }

        .rarity-secret .card-rarity {
            background: var(--rainbow);
            background-size: 200% 200%;
            color: white;
            animation: shimmer 2s infinite linear, rarityGlow 1s infinite;
        }

        .favorite-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.5);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 2;
            backdrop-filter: blur(5px);
        }

        .favorite-btn:hover {
            background: rgba(0, 0, 0, 0.7);
            transform: scale(1.1);
        }

        .favorite-btn.active {
            background: #f59e0b;
            color: white;
        }

        .card-count {
            position: absolute;
            top: 8px;
            left: 8px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 3px 6px;
            border-radius: 10px;
            font-size: 0.75rem;
            font-weight: 600;
            z-index: 2;
            backdrop-filter: blur(5px);
        }

        /* Инвентарь кастомизации */
        .customization-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            overflow-x: auto;
            padding-bottom: 8px;
        }

        .customization-tab {
            padding: 10px 16px;
            border-radius: 12px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            font-weight: 600;
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.3s ease;
            flex-shrink: 0;
            font-size: 0.9rem;
        }

        .customization-tab:hover {
            background: var(--border-color);
        }

        .customization-tab.active {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        .customization-items {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        @media (min-width: 768px) {
            .customization-items {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        .customization-item {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            text-align: center;
        }

        .customization-item:hover {
            transform: translateY(-2px);
            border-color: var(--accent-color);
            box-shadow: 0 8px 20px var(--shadow-color);
        }

        .customization-item-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--accent-color), var(--accent-light));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: white;
            margin: 0 auto 10px;
        }

        .customization-item-name {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--text-primary);
        }

        .customization-item-desc {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 10px;
            line-height: 1.3;
        }

        .customization-btn {
            width: 100%;
            padding: 8px;
            border-radius: 8px;
            border: none;
            background: var(--accent-color);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
        }

        .customization-btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .customization-btn:active {
            transform: translateY(0);
        }

        .customization-btn.equipped {
            background: #10b981;
        }

        .customization-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: var(--bg-secondary);
            color: var(--text-secondary);
        }

        /* Магазин */
        .shop-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            overflow-x: auto;
            padding-bottom: 8px;
        }

        .shop-tab {
            padding: 10px 16px;
            border-radius: 12px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            font-weight: 600;
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.3s ease;
            flex-shrink: 0;
            font-size: 0.9rem;
        }

        .shop-tab:hover {
            background: var(--border-color);
        }

        .shop-tab.active {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        .shop-items {
            display: grid;
            gap: 12px;
        }

        .shop-item {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 16px;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .shop-item:hover {
            transform: translateY(-2px);
            border-color: var(--accent-color);
            box-shadow: 0 8px 20px var(--shadow-color);
        }

        .shop-item-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .shop-item-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--accent-color), var(--accent-light));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            flex-shrink: 0;
        }

        .shop-item-title {
            flex: 1;
            min-width: 0;
        }

        .shop-item-name {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .shop-item-desc {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .shop-item-price {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--accent-color);
            margin-bottom: 12px;
        }

        .shop-item-btn {
            width: 100%;
            padding: 10px;
            border-radius: 10px;
            border: none;
            background: linear-gradient(135deg, var(--accent-color), var(--accent-light));
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .shop-item-btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .shop-item-btn:active {
            transform: translateY(0);
        }

        .shop-item-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .shop-item-btn.owned {
            background: #10b981;
        }

        /* Лидерборд */
        .leaderboard-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .leaderboard-header h1 {
            font-size: 1.5rem;
            color: var(--accent-color);
            margin-bottom: 8px;
        }

        .leaderboard-tabs {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 15px;
        }

        .leaderboard-tab {
            padding: 8px 16px;
            border-radius: 20px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
        }

        .leaderboard-tab:hover {
            border-color: var(--accent-color);
        }

        .leaderboard-tab.active {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        .leaderboard-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .leaderboard-item {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
            border: 1px solid var(--border-color);
        }

        .leaderboard-item:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 12px var(--shadow-color);
        }

        .leaderboard-item.top-3 {
            border: 2px solid var(--accent-color);
        }

        .leaderboard-rank {
            font-size: 1.2rem;
            font-weight: 800;
            min-width: 35px;
            text-align: center;
            flex-shrink: 0;
        }

        .rank-1 .leaderboard-rank {
            color: #f59e0b;
        }

        .rank-2 .leaderboard-rank {
            color: #a0a0a0;
        }

        .rank-3 .leaderboard-rank {
            color: #cd7f32;
        }

        .leaderboard-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: var(--bg-secondary);
            background-size: cover;
            background-position: center;
            flex-shrink: 0;
            border: 2px solid var(--accent-color);
        }

        .leaderboard-info {
            flex: 1;
            min-width: 0;
        }

        .leaderboard-name {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 6px;
            flex-wrap: wrap;
        }

        .username-suffix {
            background: linear-gradient(135deg, var(--accent-color), var(--accent-light));
            color: white;
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .username-suffix.animated {
            animation: suffixGlow 2s infinite;
        }

        .leaderboard-stats {
            display: flex;
            gap: 12px;
            font-size: 0.8rem;
            color: var(--text-secondary);
            flex-wrap: wrap;
        }

        .leaderboard-stat {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .leaderboard-value {
            font-weight: 700;
            color: var(--accent-color);
        }

        /* Профиль */
        .profile-header {
            text-align: center;
            margin-bottom: 20px;
            position: relative;
        }

        .profile-avatar-container {
            position: relative;
            display: inline-block;
            margin-bottom: 12px;
        }

        .profile-avatar {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            background: var(--bg-secondary);
            background-size: cover;
            background-position: center;
            border: 3px solid var(--accent-color);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .profile-frame {
            position: absolute;
            top: -8px;
            left: -8px;
            right: -8px;
            bottom: -8px;
            border: 2px solid transparent;
            border-radius: 50%;
            pointer-events: none;
        }

        .profile-frame.animated {
            animation: frameGlow 2s infinite;
        }

        .profile-name {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .profile-title {
            background: linear-gradient(135deg, var(--accent-color), var(--accent-light));
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 8px;
            display: inline-block;
        }

        .profile-id {
            background: var(--bg-secondary);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            color: var(--text-secondary);
            font-family: monospace;
        }

        .profile-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .profile-stat {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .profile-stat:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow-color);
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--accent-color);
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .level-progress {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }

        .level-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .level-bar {
            height: 10px;
            background: var(--border-color);
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 4px;
        }

        .level-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-color), var(--accent-light));
            width: 0%;
            transition: width 1s ease;
            position: relative;
            overflow: hidden;
        }

        .level-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        .level-exp {
            text-align: right;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .favorite-card-section {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }

        .favorite-card-section h3 {
            font-size: 1.1rem;
            margin-bottom: 12px;
            color: var(--accent-color);
        }

        .favorite-card-preview {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .favorite-card-preview:hover {
            transform: translateY(-2px);
        }

        .favorite-card-image {
            width: 70px;
            height: 70px;
            border-radius: 10px;
            background: var(--bg-primary);
            background-size: cover;
            background-position: center;
            flex-shrink: 0;
            border: 1px solid var(--border-color);
        }

        .favorite-card-info {
            flex: 1;
            min-width: 0;
        }

        .favorite-card-info h4 {
            font-size: 1rem;
            margin-bottom: 4px;
        }

        .favorite-card-rarity {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 600;
            color: white;
        }

        /* Кнопки доната в профиле */
        .donate-buttons {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin-top: 20px;
        }

        .donate-profile-btn {
            padding: 14px;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 0.95rem;
        }

        .donate-coins-btn {
            background: linear-gradient(135deg, #f59e0b, #fbbf24);
            color: white;
        }

        .donate-premium-btn {
            background: var(--pepepremium-gradient);
            color: white;
        }

        .donate-profile-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        .donate-profile-btn:active {
            transform: translateY(0);
        }

        /* Выбор темы */
        .theme-selector {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 16px;
            margin-top: 20px;
            border: 1px solid var(--border-color);
        }

        .theme-selector h3 {
            font-size: 1.1rem;
            margin-bottom: 12px;
            color: var(--accent-color);
        }

        .theme-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .theme-option {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .theme-option:hover {
            border-color: var(--accent-color);
        }

        .theme-option.active {
            border-color: var(--accent-color);
            background: var(--accent-color);
            color: white;
        }

        .theme-option i {
            font-size: 1.5rem;
            margin-bottom: 8px;
        }

        .theme-option span {
            font-size: 0.85rem;
            font-weight: 600;
        }

        /* Модальное окно доната */
        .donate-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .donate-content {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 25px;
            max-width: 400px;
            width: 100%;
            text-align: center;
            animation: fadeIn 0.3s ease;
            border: 2px solid var(--accent-color);
            max-height: 90vh;
            overflow-y: auto;
        }

        .donate-icon {
            font-size: 2.5rem;
            color: var(--accent-color);
            margin-bottom: 15px;
        }

        .donate-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 12px;
            color: var(--accent-color);
        }

        .donate-text {
            color: var(--text-secondary);
            margin-bottom: 20px;
            line-height: 1.5;
            font-size: 0.9rem;
        }

        .donate-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }

        .donate-option {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .donate-option:hover {
            border-color: var(--accent-color);
            transform: translateY(-2px);
        }

        .donate-option.selected {
            border-color: var(--accent-color);
            background: linear-gradient(135deg, var(--bg-secondary), rgba(139, 92, 246, 0.1));
        }

        .donate-option-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        .donate-option-icon {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: var(--accent-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1rem;
            flex-shrink: 0;
        }

        .donate-option-title {
            font-size: 1rem;
            font-weight: 600;
            flex: 1;
            text-align: left;
        }

        .donate-option-price {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--accent-color);
        }

        .donate-option-desc {
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-align: left;
            line-height: 1.4;
        }

        .donate-input-group {
            margin-bottom: 15px;
            text-align: left;
        }

        .donate-input-group label {
            display: block;
            font-size: 0.9rem;
            color: var(--text-primary);
            margin-bottom: 6px;
            font-weight: 600;
        }

        .donate-input {
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 1rem;
            font-weight: 600;
        }

        .donate-price-display {
            background: var(--bg-secondary);
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 15px;
            font-weight: 600;
            color: var(--accent-color);
            font-size: 1.1rem;
            border: 1px solid var(--border-color);
        }

        .donate-buttons-modal {
            display: flex;
            gap: 10px;
        }

        .donate-btn {
            flex: 1;
            padding: 14px;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95rem;
        }

        .donate-btn.primary {
            background: linear-gradient(135deg, var(--accent-color), var(--accent-light));
            color: white;
        }

        .donate-btn.primary:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        .donate-btn.secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .donate-btn.secondary:hover {
            background: var(--border-color);
        }

        /* Мини профиль игрока */
        .mini-profile-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .mini-profile-content {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 25px;
            max-width: 400px;
            width: 100%;
            animation: fadeIn 0.3s ease;
            border: 2px solid var(--accent-color);
            max-height: 90vh;
            overflow-y: auto;
        }

        .mini-profile-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .mini-profile-avatar {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: var(--bg-secondary);
            background-size: cover;
            background-position: center;
            margin: 0 auto 12px;
            border: 2px solid var(--accent-color);
        }

        .mini-profile-name {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            flex-wrap: wrap;
        }

        .mini-profile-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .mini-profile-stat {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 12px;
            text-align: center;
        }

        .mini-profile-stat-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--accent-color);
            margin-bottom: 4px;
        }

        .mini-profile-stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .mini-profile-favorite {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .mini-profile-favorite h4 {
            font-size: 1rem;
            margin-bottom: 12px;
            color: var(--accent-color);
        }

        .favorite-card-display {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .favorite-card-display-image {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            background: var(--bg-primary);
            background-size: cover;
            background-position: center;
            flex-shrink: 0;
            border: 1px solid var(--border-color);
        }

        .favorite-card-display-info h5 {
            font-size: 1rem;
            margin-bottom: 4px;
        }

        .favorite-card-display-rarity {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 600;
            color: white;
        }

        .mini-profile-close {
            width: 100%;
            padding: 12px;
            border-radius: 12px;
            border: none;
            background: var(--accent-color);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mini-profile-close:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        /* Анимация получения карты */
        .card-reveal-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .card-reveal-content {
            width: 100%;
            max-width: 350px;
            text-align: center;
        }

        .reveal-card {
            width: 100%;
            height: 500px;
            perspective: 1000px;
            margin-bottom: 25px;
        }

        .reveal-card-inner {
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            transition: transform 1s;
            position: relative;
        }

        .reveal-card.flipped .reveal-card-inner {
            transform: rotateY(180deg);
        }

        .reveal-card-back, .reveal-card-front {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 16px;
            overflow: hidden;
        }

        .reveal-card-back {
            background: linear-gradient(135deg, var(--card-back), var(--accent-light));
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            animation: pulse 1.5s infinite;
            border: 3px solid rgba(255, 255, 255, 0.3);
        }

        .reveal-card-back-logo {
            font-size: 3rem;
            margin-bottom: 15px;
            animation: float 2s infinite;
        }

        .reveal-card-back-text {
            font-size: 1.3rem;
            font-weight: 700;
        }

        .reveal-card-front {
            background: var(--bg-card);
            transform: rotateY(180deg);
            display: flex;
            flex-direction: column;
            border: 3px solid var(--accent-color);
        }

        .reveal-card-image {
            height: 70%;
            background-size: cover;
            background-position: center;
            background-color: var(--bg-secondary);
        }

        .reveal-card-info {
            padding: 16px;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .reveal-card-name {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--accent-color);
        }

        .reveal-card-rarity {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 0.9rem;
            font-weight: 700;
            color: white;
            margin-bottom: 12px;
        }

        .reveal-rewards {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }

        .reveal-reward {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .reveal-reward-icon {
            font-size: 1.4rem;
            color: var(--accent-color);
        }

        .reveal-reward-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--accent-color);
        }

        .reveal-reward-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* Нижнее меню */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: var(--nav-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-top: 1px solid var(--border-color);
            z-index: 1000;
            padding: 8px 16px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            height: 70px;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: var(--nav-inactive);
            transition: all 0.3s ease;
            padding: 8px 12px;
            border-radius: 12px;
            min-width: 50px;
        }

        .nav-item:hover {
            color: var(--nav-active);
            background: var(--bg-secondary);
        }

        .nav-item.active {
            color: var(--nav-active);
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(167, 139, 250, 0.1));
        }

        .nav-icon {
            font-size: 1.2rem;
            margin-bottom: 4px;
        }

        .nav-label {
            font-size: 0.65rem;
            font-weight: 600;
        }

        .nav-center {
            background: linear-gradient(135deg, var(--accent-color), var(--accent-light));
            color: white;
            padding: 10px;
            border-radius: 50%;
            transform: translateY(-10px);
            box-shadow: 0 5px 20px rgba(139, 92, 246, 0.4);
        }

        .nav-center .nav-icon {
            margin-bottom: 0;
        }

        /* Утилиты */
        .hidden {
            display: none !important;
        }

        .flex {
            display: flex;
        }

        .flex-col {
            flex-direction: column;
        }

        .items-center {
            align-items: center;
        }

        .justify-center {
            justify-content: center;
        }

        .text-center {
            text-align: center;
        }

        .mb-2 {
            margin-bottom: 10px;
        }

        .mb-3 {
            margin-bottom: 15px;
        }

        .mb-4 {
            margin-bottom: 20px;
        }

        .mt-2 {
            margin-top: 10px;
        }

        .mt-3 {
            margin-top: 15px;
        }

        .mt-4 {
            margin-top: 20px;
        }

        .gap-2 {
            gap: 10px;
        }

        .gap-3 {
            gap: 15px;
        }

        .gap-4 {
            gap: 20px;
        }

        .w-full {
            width: 100%;
        }

        /* Улучшенные стили для карточек */
        .card-item.rarity-secret {
            position: relative;
            overflow: hidden;
        }

        .card-item.rarity-secret::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--rainbow);
            background-size: 400% 400%;
            animation: shimmer 3s infinite linear;
            opacity: 0.3;
            z-index: 1;
            pointer-events: none;
        }

        .card-item.rarity-secret .card-image {
            position: relative;
            z-index: 2;
        }

        .card-item.rarity-secret .card-info {
            position: relative;
            z-index: 2;
            background: rgba(0, 0, 0, 0.7);
            color: white;
        }

        .card-item.rarity-secret .card-name {
            color: white;
        }

        /* Уведомления */
        .notification {
            position: fixed;
            top: 70px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, var(--accent-color), var(--accent-light));
            color: white;
            padding: 12px 20px;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            z-index: 2002;
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 90%;
            animation: fadeIn 0.3s ease;
        }

        .notification.error {
            background: #ef4444;
        }

        .notification.success {
            background: #10b981;
        }

        /* Адаптивность */
        @media (max-width: 480px) {
            .cards-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .customization-items {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .profile-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .theme-options {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .reveal-card {
                height: 460px;
            }
        }

        @media (max-width: 360px) {
            .cards-grid {
                grid-template-columns: 1fr;
            }
            
            .customization-items {
                grid-template-columns: 1fr;
            }
            
            .leaderboard-stats {
                flex-direction: column;
                gap: 4px;
            }
            
            .reveal-card {
                height: 440px;
            }
        }

        /* ЛИДЕРБОРД СТИЛИ */
        .leaderboard-list { display: flex; flex-direction: column; gap: 10px; padding-bottom: 20px; }
        .leaderboard-item { 
            background: var(--bg-card); 
            padding: 12px 16px; 
            border-radius: 16px; 
            display: flex; 
            align-items: center; 
            gap: 15px; 
            border: 1px solid var(--border-color);
            transition: transform 0.2s;
        }
        .leaderboard-item:active { transform: scale(0.98); }
        .lb-rank { 
            font-size: 1.2rem; 
            font-weight: 800; 
            width: 30px; 
            text-align: center; 
            color: var(--text-secondary); 
        }
        .rank-1 { color: #fbbf24; text-shadow: 0 0 15px rgba(251, 191, 36, 0.4); font-size: 1.4rem; }
        .rank-2 { color: #9ca3af; font-size: 1.3rem; }
        .rank-3 { color: #b45309; font-size: 1.3rem; }
        
        .lb-avatar { 
            width: 45px; 
            height: 45px; 
            border-radius: 50%; 
            background-color: var(--bg-secondary); 
            background-size: cover; 
            background-position: center;
            border: 2px solid var(--border-color);
            flex-shrink: 0;
        }
        .lb-info { flex: 1; display: flex; flex-direction: column; }
        .lb-name { font-weight: 700; font-size: 0.95rem; display: flex; align-items: center; gap: 5px; }
        .lb-val { color: var(--accent-color); font-weight: 800; font-size: 0.9rem; }
        .lb-me { border: 2px solid var(--accent-color); background: rgba(124, 58, 237, 0.05); }
    </style>
</head>
<body>
    <!-- Снег на фоне -->
    <div class="snow-container" id="snowContainer"></div>

    <!-- Экран загрузки -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-logo">🐸</div>
        <div class="loading-text">Загрузка PepeCards...</div>
        <div class="loading-spinner"></div>
    </div>

    <!-- Технический перерыв -->
    <div class="maintenance-overlay hidden" id="maintenanceOverlay">
        <div class="maintenance-content">
            <div class="maintenance-icon">🔧</div>
            <h2 class="maintenance-title">Технический перерыв</h2>
            <p class="maintenance-text">
                Мы улучшаем приложение для вас!<br>
                Возвращайтесь через несколько минут.<br>
                Приносим извинения за неудобства.
            </p>
        </div>
    </div>

    <!-- Шапка -->
    <header class="header">
        <div class="header-left">
            <div class="logo">
                <span class="logo-icon">🐸</span>
                <span>PepeCards</span>
            </div>
        </div>
        <div class="header-right">
            <div class="coins-display">
                <i class="fas fa-coins"></i>
                <span id="headerCoins">0</span>
            </div>
            <button class="admin-btn hidden" id="adminMenuBtn" style="padding: 6px 12px; font-size: 0.8rem;">
                <i class="fas fa-shield-alt"></i>
            </button>
        </div>
    </header>

    <!-- Основной контент -->
    <main class="main-content">
        <!-- Главная страница -->
        <div class="page active" id="mainPage">
            <div class="main-page">
                <div class="greeting">
                    <h1 id="userGreeting">Привет!</h1>
                </div>

                <div class="cooldown-section">
                    <div class="cooldown-timer" id="cooldownTimer">00:00</div>
                    <div class="cooldown-text" id="cooldownText">
                        До следующей карты
                    </div>
                </div>

                <div class="open-card-section">
                    <button class="open-card-btn" id="openCardBtn">
                        <i class="fas fa-gift"></i>
                        Открыть карту
                    </button>
                </div>
            </div>
        </div>

        <!-- Инвентарь карт -->
        <div class="page" id="inventoryPage">
            <div class="inventory-header">
                <h1>Инвентарь</h1>
                <div class="total-cards" id="totalCards">0 карт</div>
            </div>

            <div class="filters-container">
                <div class="filters-scroll">
                    <button class="filter-btn active" data-filter="all">Все</button>
                    <button class="filter-btn" data-filter="common">Обычные</button>
                    <button class="filter-btn" data-filter="rare">Редкие</button>
                    <button class="filter-btn" data-filter="epic">Эпические</button>
                    <button class="filter-btn" data-filter="legendary">Легендарные</button>
                    <button class="filter-btn" data-filter="mythic">Мифические</button>
                    <button class="filter-btn" data-filter="secret">Секретные</button>
                    <button class="filter-btn" data-filter="favorite">Избранные</button>
                </div>
            </div>

            <div class="cards-grid" id="cardsGrid">
                <!-- Карточки будут загружены динамически -->
            </div>
        </div>

        <!-- Инвентарь кастомизации -->
        <div class="page" id="customizationPage">
            <div class="inventory-header">
                <h1>Персонализация</h1>
                <div class="total-cards" id="totalCustomization">0 предметов</div>
            </div>

            <div class="customization-tabs">
                <button class="customization-tab active" data-tab="suffixes">Суффиксы</button>
                <button class="customization-tab" data-tab="frames">Рамки</button>
                <button class="customization-tab" data-tab="titles">Титулы</button>
            </div>

            <div class="customization-content">
                <div class="customization-items" id="suffixesTab">
                    <!-- Суффиксы будут загружены динамически -->
                </div>
                <div class="customization-items hidden" id="framesTab">
                    <!-- Рамки будут загружены динамически -->
                </div>
                <div class="customization-items hidden" id="titlesTab">
                    <!-- Титулы будут загружены динамически -->
                </div>
            </div>
        </div>

        <!-- Магазин -->
        <div class="page" id="shopPage">
            <div class="shop-tabs">
                <button class="shop-tab active" data-tab="packs">Наборы</button>
                <button class="shop-tab" data-tab="personalization">Персонализация</button>
                <button class="shop-tab" data-tab="vip">VIP</button>
            </div>

            <div class="shop-content">
                <!-- Наборы карт -->
                <div class="shop-items" id="packsTab">
                    <!-- Товары будут загружены динамически -->
                </div>

                <!-- Персонализация -->
                <div class="shop-items hidden" id="personalizationTab">
                    <!-- Суффиксы и рамки будут загружены динамически -->
                </div>

                <!-- VIP -->
                <div class="shop-items hidden" id="vipTab">
                    <!-- VIP товары будут загружены динамически -->
                </div>
            </div>
        </div>

        <!-- Лидерборд -->
        <div class="page" id="leaderboardPage">
            <div class="leaderboard-header">
                <h1>Лидерборд</h1>
                <p>Топ игроков PepeCards</p>
            </div>

            <div class="leaderboard-tabs">
                <button class="leaderboard-tab active" data-type="level">По уровню</button>
                <button class="leaderboard-tab" data-type="cards">По картам</button>
                <button class="leaderboard-tab" data-type="coins">По монетам</button>
                <button class="leaderboard-tab" data-type="unique">По уникальным</button>
            </div>

            <div class="leaderboard-list" id="leaderboardList">
                <!-- Игроки будут загружены динамически -->
            </div>
        </div>

        <!-- Профиль -->
        <div class="page" id="profilePage">
            <div class="profile-header">
                <div class="profile-avatar-container">
                    <div class="profile-avatar" id="profileAvatar"></div>
                    <div class="profile-frame" id="profileFrame"></div>
                </div>
                
                <div class="profile-name">
                    <span id="profileName">Игрок</span>
                    <span class="username-suffix hidden" id="usernameSuffix"></span>
                </div>
                
                <div class="profile-title" id="profileTitle">Новичок</div>
                <div class="profile-id mt-2" id="profileId">#0</div>
            </div>

            <div class="profile-stats">
                <div class="profile-stat">
                    <div class="stat-value" id="statLevel">1</div>
                    <div class="stat-label">Уровень</div>
                </div>
                <div class="profile-stat">
                    <div class="stat-value" id="statCards">0</div>
                    <div class="stat-label">Карт</div>
                </div>
                <div class="profile-stat">
                    <div class="stat-value" id="statCoins">0</div>
                    <div class="stat-label">Монет</div>
                </div>
                <div class="profile-stat">
                    <div class="stat-value" id="statUnique">0</div>
                    <div class="stat-label">Уникальных</div>
                </div>
            </div>

            <div class="level-progress">
                <div class="level-info">
                    <span>Уровень <span id="currentLevel">1</span></span>
                    <span>До <span id="nextLevel">2</span></span>
                </div>
                <div class="level-bar">
                    <div class="level-fill" id="levelFill"></div>
                </div>
                <div class="level-exp" id="levelExp">0/100 опыта</div>
            </div>

            <div class="favorite-card-section">
                <h3>Любимая карта</h3>
                <div class="favorite-card-preview" id="favoriteCardPreview">
                    <div class="favorite-card-image" id="favoriteCardImage"></div>
                    <div class="favorite-card-info">
                        <h4 id="favoriteCardName">Не выбрана</h4>
                        <div class="favorite-card-rarity" id="favoriteCardRarity"></div>
                    </div>
                </div>
            </div>

            <!-- Кнопки доната -->
            <div class="donate-buttons">
                <button class="donate-profile-btn donate-coins-btn" id="profileDonateCoinsBtn">
                    <i class="fas fa-coins"></i>
                    Купить PepeCoins
                </button>
                <button class="donate-profile-btn donate-premium-btn" id="profileDonatePremiumBtn">
                    <i class="fas fa-crown"></i>
                    PepePremium
                </button>
            </div>

            <!-- Выбор темы -->
            <div class="theme-selector">
                <h3>Выбор темы</h3>
                <div class="theme-options">
                    <div class="theme-option active" data-theme="light">
                        <i class="fas fa-sun"></i>
                        <span>Светлая</span>
                    </div>
                    <div class="theme-option" data-theme="dark-purple">
                        <i class="fas fa-moon"></i>
                        <span>Фиолетовая</span>
                    </div>
                    <div class="theme-option" data-theme="night">
                        <i class="fas fa-star"></i>
                        <span>Ночная</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Админ панель (отдельная страница) -->
        <div class="page" id="adminPage">
            <div class="admin-section">
                <h2><i class="fas fa-shield-alt"></i> Админ Панель</h2>
                <div class="admin-controls">
                    <div class="admin-control-group">
                        <h3>Поиск игрока</h3>
                        <input type="text" class="admin-input" id="adminPlayerId" placeholder="ID игрока (#123) или TG ID">
                        <button class="admin-btn" id="adminSearchBtn">Найти игрока</button>
                    </div>
                    
                    <!-- Информация о найденном игроке -->
                    <div class="admin-player-info hidden" id="adminPlayerInfo">
                        <h4>Информация об игроке</h4>
                        <div class="admin-player-stats">
                            <div class="admin-player-stat">
                                <div class="admin-player-stat-value" id="adminPlayerName">-</div>
                                <div class="admin-player-stat-label">Имя</div>
                            </div>
                            <div class="admin-player-stat">
                                <div class="admin-player-stat-value" id="adminPlayerLevel">-</div>
                                <div class="admin-player-stat-label">Уровень</div>
                            </div>
                            <div class="admin-player-stat">
                                <div class="admin-player-stat-value" id="adminPlayerCoins">-</div>
                                <div class="admin-player-stat-label">Монеты</div>
                            </div>
                            <div class="admin-player-stat">
                                <div class="admin-player-stat-value" id="adminPlayerCards">-</div>
                                <div class="admin-player-stat-label">Карты</div>
                            </div>
                            <div class="admin-player-stat">
                                <div class="admin-player-stat-value" id="adminPlayerUnique">-</div>
                                <div class="admin-player-stat-label">Уникальных</div>
                            </div>
                            <div class="admin-player-stat">
                                <div class="admin-player-stat-value" id="adminPlayerPremium">-</div>
                                <div class="admin-player-stat-label">Premium</div>
                            </div>
                            <div class="admin-player-stat">
                                <div class="admin-player-stat-value" id="adminPlayerVIP">-</div>
                                <div class="admin-player-stat-label">VIP</div>
                            </div>
                            <div class="admin-player-stat">
                                <div class="admin-player-stat-value" id="adminPlayerLastCard">-</div>
                                <div class="admin-player-stat-label">Последняя карта</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="admin-control-group">
                        <h3>Текущий игрок: <span id="adminCurrentPlayer">Не выбран</span></h3>
                        <input type="number" class="admin-input" id="adminCoinsAmount" placeholder="Количество монет">
                        <button class="admin-btn success" id="adminAddCoinsBtn">Выдать монеты</button>
                        <button class="admin-btn success" id="adminAddPremiumBtn">Выдать Premium</button>
                        <button class="admin-btn" id="adminAddVipBtn">Выдать VIP</button>
                    </div>
                    
                    <div class="admin-control-group">
                        <h3>Администрирование</h3>
                        <button class="admin-btn" id="adminBanBtn">Забанить</button>
                        <button class="admin-btn" id="adminResetBtn">Сбросить профиль</button>
                        <button class="admin-btn" id="adminMaintenanceBtn">Вкл/Выкл техперерыв</button>
                        <button class="admin-btn" id="adminAddCardBtn">Выдать карту</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Модальное окно доната (PepeCoins) -->
    <div class="donate-modal hidden" id="donateCoinsModal">
        <div class="donate-content">
            <div class="donate-icon">💎</div>
            <h2 class="donate-title">Купить PepeCoins</h2>
            <p class="donate-text">
                Минимальная покупка: 100 PepeCoins<br>
                <small>1 PepeCoin = 0.03 звезды</small>
            </p>
            
            <div class="donate-input-group">
                <label>Количество PepeCoins:</label>
                <input type="number" class="donate-input" id="donateCoinsAmount" value="100" min="100" step="100">
            </div>
            
            <div class="donate-price-display" id="donateCoinsPrice">
                100 PepeCoins = ⭐ 3
            </div>
            
            <div class="donate-options">
                <div class="donate-option selected" data-method="stars">
                    <div class="donate-option-header">
                        <div class="donate-option-icon"><i class="fas fa-star"></i></div>
                        <div class="donate-option-title">Звезды Telegram</div>
                        <div class="donate-option-price" id="starsPrice">⭐ 3</div>
                    </div>
                    <p class="donate-option-desc">Мгновенная оплата через Telegram Stars</p>
                </div>
                
                <div class="donate-option" data-method="rubles">
                    <div class="donate-option-header">
                        <div class="donate-option-icon"><i class="fas fa-ruble-sign"></i></div>
                        <div class="donate-option-title">Рубли (дешевле)</div>
                        <div class="donate-option-price" id="rublesPrice">15 ₽</div>
                    </div>
                    <p class="donate-option-desc">Написать @DefoltPlayer для оплаты</p>
                </div>
            </div>

            <div class="donate-buttons-modal">
                <button class="donate-btn secondary" id="donateCoinsCloseBtn">Отмена</button>
                <button class="donate-btn primary" id="donateCoinsConfirmBtn">Купить</button>
            </div>
        </div>
    </div>

    <!-- Модальное окно доната (PepePremium) -->
    <div class="donate-modal hidden" id="donatePremiumModal">
        <div class="donate-content">
            <div class="donate-icon">👑</div>
            <h2 class="donate-title">PepePremium</h2>
            <p class="donate-text">
                Премиум статус на 30 дней:<br>
                • Кулдаун 5 минут<br>
                • +50% монет и опыта<br>
                • Особый значок<br>
                <small>Лучшая инвестиция в вашу коллекцию!</small>
            </p>
            
            <div class="donate-options">
                <div class="donate-option selected" data-method="stars">
                    <div class="donate-option-header">
                        <div class="donate-option-icon"><i class="fas fa-star"></i></div>
                        <div class="donate-option-title">Звезды Telegram</div>
                        <div class="donate-option-price">⭐ 200</div>
                    </div>
                    <p class="donate-option-desc">Мгновенная оплата через Telegram Stars</p>
                </div>
                
                <div class="donate-option" data-method="rubles">
                    <div class="donate-option-header">
                        <div class="donate-option-icon"><i class="fas fa-ruble-sign"></i></div>
                        <div class="donate-option-title">Рубли</div>
                        <div class="donate-option-price">100 ₽</div>
                    </div>
                    <p class="donate-option-desc">Написать @DefoltPlayer для оплаты</p>
                </div>
            </div>

            <div class="donate-buttons-modal">
                <button class="donate-btn secondary" id="donatePremiumCloseBtn">Отмена</button>
                <button class="donate-btn primary" id="donatePremiumConfirmBtn">Купить Premium</button>
            </div>
        </div>
    </div>

    <!-- Мини профиль игрока -->
    <div class="mini-profile-modal hidden" id="miniProfileModal">
        <div class="mini-profile-content">
            <div class="mini-profile-header">
                <div class="mini-profile-avatar" id="miniProfileAvatar"></div>
                <div class="mini-profile-name">
                    <span id="miniProfileName"></span>
                    <span class="username-suffix hidden" id="miniProfileSuffix"></span>
                </div>
            </div>
            
            <div class="mini-profile-stats">
                <div class="mini-profile-stat">
                    <div class="mini-profile-stat-value" id="miniProfileLevel"></div>
                    <div class="mini-profile-stat-label">Уровень</div>
                </div>
                <div class="mini-profile-stat">
                    <div class="mini-profile-stat-value" id="miniProfileCards"></div>
                    <div class="mini-profile-stat-label">Карт</div>
                </div>
                <div class="mini-profile-stat">
                    <div class="mini-profile-stat-value" id="miniProfileCoins"></div>
                    <div class="mini-profile-stat-label">Монет</div>
                </div>
                <div class="mini-profile-stat">
                    <div class="mini-profile-stat-value" id="miniProfileUnique"></div>
                    <div class="mini-profile-stat-label">Уникальных</div>
                </div>
            </div>

            <div class="mini-profile-favorite">
                <h4>Любимая карта</h4>
                <div class="favorite-card-display">
                    <div class="favorite-card-display-image" id="miniFavoriteCardImage"></div>
                    <div class="favorite-card-display-info">
                        <h5 id="miniFavoriteCardName">Не выбрана</h5>
                        <div class="favorite-card-display-rarity" id="miniFavoriteCardRarity"></div>
                    </div>
                </div>
            </div>

            <button class="mini-profile-close" id="miniProfileCloseBtn">Закрыть</button>
        </div>
    </div>

    <!-- Анимация получения карты -->
    <div class="card-reveal-modal hidden" id="cardRevealModal">
        <div class="card-reveal-content">
            <div class="reveal-card" id="revealCard">
                <div class="reveal-card-inner">
                    <div class="reveal-card-back">
                        <div class="reveal-card-back-logo">🐸</div>
                        <div class="reveal-card-back-text">PepeCards</div>
                    </div>
                    <div class="reveal-card-front">
                        <div class="reveal-card-image" id="revealCardImage"></div>
                        <div class="reveal-card-info">
                            <div class="reveal-card-name" id="revealCardName"></div>
                            <div class="reveal-card-rarity" id="revealCardRarity"></div>
                            
                            <div class="reveal-rewards" id="revealRewards">
                                <!-- Награды будут добавлены динамически -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Нижнее меню -->
    <nav class="bottom-nav">
        <a href="#" class="nav-item" data-page="inventory">
            <div class="nav-icon"><i class="fas fa-box"></i></div>
            <div class="nav-label">Карты</div>
        </a>
        
        <a href="#" class="nav-item" data-page="customization">
            <div class="nav-icon"><i class="fas fa-tshirt"></i></div>
            <div class="nav-label">Стиль</div>
        </a>
        
        <a href="#" class="nav-item nav-center active" data-page="main">
            <div class="nav-icon"><i class="fas fa-home"></i></div>
            <div class="nav-label">Главная</div>
        </a>
        
        <a href="#" class="nav-item" data-page="shop">
            <div class="nav-icon"><i class="fas fa-store"></i></div>
            <div class="nav-label">Магазин</div>
        </a>
        
        <a href="#" class="nav-item" data-page="profile">
            <div class="nav-icon"><i class="fas fa-user"></i></div>
            <div class="nav-label">Профиль</div>
        </a>
    </nav>

    <script>
        // Конфигурация приложения
        const CONFIG = {
            ADMIN_ID: 6392172528,
            COOLDOWN_NORMAL: 2400, // 40 минут в секундах
            COOLDOWN_VIP: 1200, // 20 минут в секундах
            COOLDOWN_PREMIUM: 300, // 5 минут в секундах
            COOLDOWN_ADMIN: 0, // Админ без кулдауна
            
            // Карточки с фиксированными наградами по редкости
            CARDS: {
                1: {
                    "id": 1,
                    "name": "Дефолтная Пепе",
                    "rarity": "common",
                    "rarityName": "Обычная",
                    "emoji": "⚪",
                    "chance": 40,
                    "coins": 100,
                    "exp": 50,
                    "image_path": "data/images/test1.jpg",
                    "description": "Стандартный Пепе, с которого начинается каждая коллекция."
                },
                2: {
                    "id": 2,
                    "name": "Клоун Пепе",
                    "rarity": "common",
                    "rarityName": "Обычная",
                    "emoji": "⚪",
                    "chance": 40,
                    "coins": 100,
                    "exp": 50,
                    "image_path": "data/images/test2.jpg",
                    "description": "Веселый клоун Пепе, который всегда поднимет настроение."
                },
                3: {
                    "id": 3,
                    "name": "Пепе В Кофте",
                    "rarity": "common",
                    "rarityName": "Обычная",
                    "emoji": "⚪",
                    "chance": 40,
                    "coins": 100,
                    "exp": 50,
                    "image_path": "data/images/test3.jpg",
                    "description": "Стильный Пепе в теплой кофте для холодных дней."
                },
                4: {
                    "id": 4,
                    "name": "Тупой Пепе",
                    "rarity": "common",
                    "rarityName": "Обычная",
                    "emoji": "⚪",
                    "chance": 40,
                    "coins": 100,
                    "exp": 50,
                    "image_path": "data/images/test4.jpg",
                    "description": "Пепе, который не всегда понимает, что происходит вокруг."
                },
                5: {
                    "id": 5,
                    "name": "Весёлый Пепе",
                    "rarity": "common",
                    "rarityName": "Обычная",
                    "emoji": "⚪",
                    "chance": 40,
                    "coins": 100,
                    "exp": 50,
                    "image_path": "data/images/test5.jpg",
                    "description": "Всегда позитивный Пепе, который видит хорошее во всем."
                },
                6: {
                    "id": 6,
                    "name": "Грустный Пепе",
                    "rarity": "common",
                    "rarityName": "Обычная",
                    "emoji": "⚪",
                    "chance": 40,
                    "coins": 100,
                    "exp": 50,
                    "image_path": "data/images/test6.jpg",
                    "description": "Пепе, который переживает не самые лучшие времена."
                },
                7: {
                    "id": 7,
                    "name": "Смеющийся Пепе",
                    "rarity": "common",
                    "rarityName": "Обычная",
                    "emoji": "⚪",
                    "chance": 40,
                    "coins": 100,
                    "exp": 50,
                    "image_path": "data/images/test7.jpg",
                    "description": "Пепе, который не может перестать смеяться над шуткой."
                },
                8: {
                    "id": 8,
                    "name": "Террорист Пепе",
                    "rarity": "common",
                    "rarityName": "Обычная",
                    "emoji": "⚪",
                    "chance": 40,
                    "coins": 100,
                    "exp": 50,
                    "image_path": "data/images/test8.jpg",
                    "description": "Пепе с опасными планами (шутка, конечно же)."
                },
                9: {
                    "id": 9,
                    "name": "Курящий Пепе",
                    "rarity": "rare",
                    "rarityName": "Редкая",
                    "emoji": "🔵",
                    "chance": 30,
                    "coins": 300,
                    "exp": 150,
                    "image_path": "data/images/test9.jpg",
                    "description": "Пепе, который любит расслабиться с сигаретой после тяжелого дня."
                },
                10: {
                    "id": 10,
                    "name": "Угашенный Пепе",
                    "rarity": "rare",
                    "rarityName": "Редкая",
                    "emoji": "🔵",
                    "chance": 30,
                    "coins": 300,
                    "exp": 150,
                    "image_path": "data/images/test10.jpg",
                    "description": "Пепе под воздействием зеленого вещества растительного происхождения."
                },
                11: {
                    "id": 11,
                    "name": "Уставший Пепе",
                    "rarity": "rare",
                    "rarityName": "Редкая",
                    "emoji": "🔵",
                    "chance": 30,
                    "coins": 300,
                    "exp": 150,
                    "image_path": "data/images/test11.jpg",
                    "description": "Пепе после тяжелого рабочего дня или бессонной ночи."
                },
                12: {
                    "id": 12,
                    "name": "Непонимающий Пепе",
                    "rarity": "rare",
                    "rarityName": "Редкая",
                    "emoji": "🔵",
                    "chance": 30,
                    "coins": 300,
                    "exp": 150,
                    "image_path": "data/images/test12.jpg",
                    "description": "Пепе, который совершенно не понимает, что происходит."
                },
                13: {
                    "id": 13,
                    "name": "Испуганный Пепе",
                    "rarity": "rare",
                    "rarityName": "Редкая",
                    "emoji": "🔵",
                    "chance": 30,
                    "coins": 300,
                    "exp": 150,
                    "image_path": "data/images/test13.jpg",
                    "description": "Пепе, который увидел нечто ужасающее."
                },
                14: {
                    "id": 14,
                    "name": "Акулёнок Пепе",
                    "rarity": "rare",
                    "rarityName": "Редкая",
                    "emoji": "🔵",
                    "chance": 30,
                    "coins": 300,
                    "exp": 150,
                    "image_path": "data/images/test14.jpg",
                    "description": "Милейший Пепе в костюме акулёнка."
                },
                15: {
                    "id": 15,
                    "name": "Пикми Пепе",
                    "rarity": "epic",
                    "rarityName": "Эпическая",
                    "emoji": "🟣",
                    "chance": 20,
                    "coins": 800,
                    "exp": 400,
                    "image_path": "data/images/test15.jpg",
                    "description": "Пепе в стиле известных инопланетных существ Пикми."
                },
                16: {
                    "id": 16,
                    "name": "Задрот Пепе",
                    "rarity": "epic",
                    "rarityName": "Эпическая",
                    "emoji": "🟣",
                    "chance": 20,
                    "coins": 800,
                    "exp": 400,
                    "image_path": "data/images/test16.jpg",
                    "description": "Пепе, который проводит все время за компьютерными играми."
                },
                17: {
                    "id": 17,
                    "name": "Бэтмэн Пепе",
                    "rarity": "epic",
                    "rarityName": "Эпическая",
                    "emoji": "🟣",
                    "chance": 20,
                    "coins": 800,
                    "exp": 400,
                    "image_path": "data/images/test17.jpg",
                    "description": "Темный рыцарь Пепе, защитник Готэма."
                },
                18: {
                    "id": 18,
                    "name": "Новогодний Пепе",
                    "rarity": "epic",
                    "rarityName": "Эпическая",
                    "emoji": "🟣",
                    "chance": 20,
                    "coins": 800,
                    "exp": 400,
                    "image_path": "data/images/test18.jpg",
                    "description": "Пепе в новогоднем настроении с подарками и гирляндами."
                },
                19: {
                    "id": 19,
                    "name": "Снайпер Пепе",
                    "rarity": "legendary",
                    "rarityName": "Легендарная",
                    "emoji": "🟡",
                    "chance": 10,
                    "coins": 2000,
                    "exp": 1000,
                    "image_path": "data/images/test19.jpg",
                    "description": "Пепе - мастер меткой стрельбы, никогда не промахивается."
                },
                20: {
                    "id": 20,
                    "name": "Таинственный Пепе",
                    "rarity": "legendary",
                    "rarityName": "Легендарная",
                    "emoji": "🟡",
                    "chance": 10,
                    "coins": 2000,
                    "exp": 1000,
                    "image_path": "data/images/test20.jpg",
                    "description": "Загадочный Пепе, окутанный тайнами и секретами."
                },
                21: {
                    "id": 21,
                    "name": "Telegram Pepe",
                    "rarity": "secret",
                    "rarityName": "Секретная",
                    "emoji": "👁️",
                    "chance": 0.1,
                    "coins": 10000,
                    "exp": 5000,
                    "image_path": "data/images/secret.jpg",
                    "description": "Секретная карта Пепе, связанная с мессенджером Telegram. Невероятно редкая!",
                    "secret": true
                },
                22: {
                    "id": 22,
                    "name": "Джорджи Пепе",
                    "rarity": "mythic",
                    "rarityName": "Мифическая",
                    "emoji": "🔴",
                    "chance": 3,
                    "coins": 4000,
                    "exp": 2000,
                    "image_path": "data/images/test22.jpg",
                    "description": "Мифический Пепе по имени Джорджи, обладающий невероятной силой."
                },
                23: {
                    "id": 23,
                    "name": "Сонный Пепе",
                    "rarity": "mythic",
                    "rarityName": "Мифическая",
                    "emoji": "🔴",
                    "chance": 3,
                    "coins": 4000,
                    "exp": 2000,
                    "image_path": "data/images/test23.jpg",
                    "description": "Пепе, который вечно хочет спать, но обладает мифической силой сновидений."
                },
                24: {
                    "id": 24,
                    "name": "Менеджер Пепе",
                    "rarity": "mythic",
                    "rarityName": "Мифическая",
                    "emoji": "🔴",
                    "chance": 3,
                    "coins": 4000,
                    "exp": 2000,
                    "image_path": "data/images/test24.jpg",
                    "description": "Пепе-менеджер, который эффективно управляет всеми процессами."
                },
                25: {
                    "id": 25,
                    "name": "Пепе Матрица",
                    "rarity": "mythic",
                    "rarityName": "Мифическая",
                    "emoji": "🔴",
                    "chance": 3,
                    "coins": 4000,
                    "exp": 2000,
                    "image_path": "data/images/test25.jpg",
                    "description": "Пепе, который выбрался из Матрицы и теперь видит код реальности."
                }
            },

            // Редкости и их множители наград
            RARITY_MULTIPLIERS: {
                'common': { coins: 100, exp: 50 },
                'rare': { coins: 300, exp: 150 },
                'epic': { coins: 800, exp: 400 },
                'legendary': { coins: 2000, exp: 1000 },
                'mythic': { coins: 4000, exp: 2000 },
                'secret': { coins: 10000, exp: 5000 }
            },

            // Магазин
            SHOP_ITEMS: {
                packs: [
                    {
                        id: 'pack_common',
                        name: 'Обычный набор',
                        description: '3 случайные карты (обычные и выше)',
                        price: 500,
                        icon: 'fa-box',
                        type: 'pack',
                        data: { cards: 3, minRarity: 'common' }
                    },
                    {
                        id: 'pack_rare',
                        name: 'Редкий набор',
                        description: '2 карты гарантированно редкие или выше',
                        price: 800,
                        icon: 'fa-box-open',
                        type: 'pack',
                        data: { cards: 2, minRarity: 'rare' }
                    },
                    {
                        id: 'pack_epic',
                        name: 'Эпический набор',
                        description: '1 эпическая карта гарантированно',
                        price: 1500,
                        icon: 'fa-crown',
                        type: 'pack',
                        data: { cards: 1, minRarity: 'epic' }
                    },
                    {
                        id: 'pack_legendary',
                        name: 'Легендарный набор',
                        description: 'Шанс на легендарную карту',
                        price: 3000,
                        icon: 'fa-gem',
                        type: 'pack',
                        data: { cards: 1, minRarity: 'legendary' }
                    }
                ],
                
                personalization: [
                    {
                        id: 'suffix_fire',
                        name: '🔥 Огненный',
                        description: 'Горящий суффикс рядом с ником',
                        price: 500,
                        icon: 'fa-fire',
                        type: 'suffix',
                        data: { text: '🔥', color: 'linear-gradient(45deg, #ff0000, #ff8800)', animated: true }
                    },
                    {
                        id: 'suffix_star',
                        name: '⭐ Звездный',
                        description: 'Сверкающая звезда',
                        price: 300,
                        icon: 'fa-star',
                        type: 'suffix',
                        data: { text: '⭐', color: 'linear-gradient(45deg, #ffd700, #ffff00)', animated: false }
                    },
                    {
                        id: 'suffix_crown',
                        name: '👑 Королевский',
                        description: 'Королевская корона',
                        price: 1000,
                        icon: 'fa-crown',
                        type: 'suffix',
                        data: { text: '👑', color: 'linear-gradient(45deg, #f59e0b, #fbbf24)', animated: true }
                    },
                    {
                        id: 'frame_gold',
                        name: 'Золотая рамка',
                        description: 'Золотая рамка для аватара',
                        price: 1000,
                        icon: 'fa-square',
                        type: 'frame',
                        data: { color: '#f59e0b', width: '3px', animated: false }
                    },
                    {
                        id: 'frame_rainbow',
                        name: 'Радужная рамка',
                        description: 'Радужная анимированная рамка',
                        price: 2500,
                        icon: 'fa-rainbow',
                        type: 'frame',
                        data: { gradient: 'linear-gradient(45deg, red, orange, yellow, green, blue, indigo, violet)', width: '3px', animated: true }
                    },
                    {
                        id: 'frame_glow',
                        name: 'Светящаяся рамка',
                        description: 'Светящаяся фиолетовая рамка',
                        price: 1500,
                        icon: 'fa-circle',
                        type: 'frame',
                        data: { color: '#8b5cf6', width: '4px', animated: true }
                    }
                ],
                
                vip: [
                    {
                        id: 'vip_7days',
                        name: 'VIP 7 дней',
                        description: 'Кулдаун 20 минут, +25% наград',
                        price: 25000,
                        icon: 'fa-star',
                        type: 'vip',
                        data: { days: 7 }
                    }
                ]
            },

            // Кастомизация (для инвентаря)
            CUSTOMIZATION_ITEMS: {
                suffixes: [],
                frames: [],
                titles: []
            },

            // Титулы для уровней
            LEVEL_TITLES: {
                1: "Новичок",
                5: "Коллекционер",
                10: "Мастер",
                15: "Эксперт",
                20: "Профи",
                25: "Ветеран",
                30: "Легенда",
                35: "Магистр",
                40: "Грандмастер",
                45: "Чемпион",
                50: "PepeLegend"
            }
        };

        // База данных пользователей
        let USERS_DB = {};
        let lastUserId = 0;

        // Инициализация базы данных
        function initUsersDatabase() {
            const db = localStorage.getItem('pepecards_users_db');
            if (db) {
                USERS_DB = JSON.parse(db);
                lastUserId = parseInt(localStorage.getItem('pepecards_last_user_id') || '0');
            } else {
                USERS_DB = {};
                lastUserId = 0;
                localStorage.setItem('pepecards_users_db', JSON.stringify(USERS_DB));
                localStorage.setItem('pepecards_last_user_id', '0');
            }
        }

        // Сохранение базы данных
        function saveUsersDatabase() {
            localStorage.setItem('pepecards_users_db', JSON.stringify(USERS_DB));
            localStorage.setItem('pepecards_last_user_id', lastUserId.toString());
        }

        // Генерация уникального ID игрока
        function generatePlayerId() {
            lastUserId++;
            return lastUserId;
        }

        // Получение или создание записи пользователя
        function getOrCreateUser(user) {
            const userId = user.id.toString();
            
            // Проверяем, есть ли пользователь с таким Telegram ID
            for (const key in USERS_DB) {
                if (USERS_DB[key].user && USERS_DB[key].user.id === user.id) {
                    return USERS_DB[key];
                }
            }
            
            // Создаем нового пользователя
            const newUser = {
                playerId: generatePlayerId(),
                user: user,
                telegramData: window.Telegram.WebApp.initDataUnsafe,
                coins: 100,
                exp: 0,
                level: 1,
                expToNextLevel: 100,
                cards: [],
                favoriteCard: null,
                equippedSuffix: null,
                equippedFrame: null,
                equippedTitle: 'Новичок',
                ownedItems: {
                    suffixes: [],
                    frames: [],
                    titles: []
                },
                isVIP: false,
                vipUntil: null,
                isPremium: false,
                premiumUntil: null,
                lastCardTime: 0,
                registrationDate: new Date().toISOString(),
                isAdmin: user.id === CONFIG.ADMIN_ID,
                theme: 'light'
            };
            
            USERS_DB[newUser.playerId] = newUser;
            saveUsersDatabase();
            
            return newUser;
        }

        // Обновление пользователя в базе данных
        function updateUserInDatabase(playerId, updates) {
            if (USERS_DB[playerId]) {
                Object.assign(USERS_DB[playerId], updates);
                saveUsersDatabase();
            }
        }

        // Получение всех пользователей
        function getAllUsers() {
            return Object.values(USERS_DB);
        }

        // Поиск пользователя по ID игрока
        function findUserByPlayerId(playerId) {
            return USERS_DB[playerId];
        }

        // Поиск пользователя по Telegram ID
        function findUserByTelegramId(telegramId) {
            return Object.values(USERS_DB).find(user => user.user.id === telegramId);
        }

        // Состояние приложения
        let appState = {
            // Данные текущего пользователя
            user: null,
            telegramData: null,
            
            // Статистика
            coins: 0,
            exp: 0,
            level: 1,
            expToNextLevel: 100,
            
            // Карты
            cards: [],
            favoriteCard: null,
            
            // Персонализация
            equippedSuffix: null,
            equippedFrame: null,
            equippedTitle: null,
            
            // Купленные предметы
            ownedItems: {
                suffixes: [],
                frames: [],
                titles: []
            },
            
            // Статусы
            isVIP: false,
            vipUntil: null,
            isPremium: false,
            premiumUntil: null,
            
            // Временные метки
            lastCardTime: 0,
            registrationDate: null,
            
            // Админ статус
            isAdmin: false,
            
            // Тема
            theme: 'light',
            
            // Админ: выбранный игрок
            adminSelectedPlayer: null,
            
            // Уникальный ID игрока
            playerId: 0
        };

        // Глобальные переменные
        let telegram = null;
        let currentPage = 'main';
        let maintenanceMode = localStorage.getItem('pepecards_maintenance') === 'true';

        // Инициализация приложения
        async function initApp() {
            try {
                // Инициализация Telegram Web App
                telegram = window.Telegram.WebApp;
                telegram.ready();
                telegram.expand();
                
                // Инициализация базы данных
                initUsersDatabase();
                
                // Получаем данные пользователя
                const user = telegram.initDataUnsafe.user;
                
                // Загружаем или создаем профиль
                await loadOrCreateProfile(user);
                
                // Настройка темы
                setupTheme();
                
                // Создаем снег
                createSnow();
                
                // Настройка обработчиков событий
                setupEventListeners();
                
                // Обновляем UI
                updateUI();
                updateInventory();
                updateCustomization();
                updateShop();
                updateLeaderboard();
                
                // Запускаем таймеры
                updateCooldown();
                setInterval(updateCooldown, 1000);
                
                // Проверяем технический перерыв
                if (maintenanceMode && !appState.isAdmin) {
                    maintenanceOverlay.classList.remove('hidden');
                }
                
                // Скрываем экран загрузки
                setTimeout(() => {
                    loadingScreen.style.opacity = '0';
                    setTimeout(() => {
                        loadingScreen.classList.add('hidden');
                    }, 300);
                }, 1000);
                
                // Приветственное сообщение
                setTimeout(() => {
                    showNotification(`Добро пожаловать, ${user.first_name}! 🐸`);
                }, 1500);
                
            } catch (error) {
                console.error('Ошибка инициализации:', error);
                showNotification('Ошибка загрузки приложения', 'error');
                loadingScreen.querySelector('.loading-text').textContent = 'Ошибка загрузки. Обновите страницу.';
            }
        }

        // Загрузка или создание профиля
        async function loadOrCreateProfile(user) {
            const userData = getOrCreateUser(user);
            
            // Копируем данные в appState
            Object.assign(appState, userData);
            
            // Проверяем актуальность VIP/Premium
            const now = new Date();
            if (appState.vipUntil && new Date(appState.vipUntil) < now) {
                appState.isVIP = false;
                appState.vipUntil = null;
            }
            if (appState.premiumUntil && new Date(appState.premiumUntil) < now) {
                appState.isPremium = false;
                appState.premiumUntil = null;
            }
            
            // Загружаем сохраненную тему
            const savedTheme = localStorage.getItem('pepecards_theme');
            if (savedTheme) {
                appState.theme = savedTheme;
                updateUserInDatabase(appState.playerId, { theme: savedTheme });
            }
            
            // Сохраняем обновленные данные
            updateUserInDatabase(appState.playerId, appState);
        }

        // Остальной код остается практически таким же, но с обновленными функциями для работы с новой структурой базы данных...

        // Обновление профиля
        function updateProfile() {
            if (!appState.user) return;
            
            // Аватар
            if (appState.user.photo_url) {
                profileAvatar.style.backgroundImage = `url('${appState.user.photo_url}')`;
                profileAvatar.innerHTML = '';
            } else {
                const colors = ['#8B5CF6', '#A78BFA', '#3B82F6', '#10B981', '#F59E0B'];
                const color = colors[appState.user.id % colors.length];
                profileAvatar.style.background = `linear-gradient(135deg, ${color}, ${color}80)`;
                profileAvatar.innerHTML = `<i class="fas fa-user" style="color: white; font-size: 1.8rem;"></i>`;
            }
            
            // Рамка профиля
            if (appState.equippedFrame) {
                profileFrame.classList.remove('animated');
                
                if (appState.equippedFrame.data.gradient) {
                    profileFrame.style.border = `${appState.equippedFrame.data.width} solid`;
                    profileFrame.style.borderImage = appState.equippedFrame.data.gradient;
                    profileFrame.style.borderImageSlice = 1;
                } else {
                    profileFrame.style.border = `${appState.equippedFrame.data.width} solid ${appState.equippedFrame.data.color}`;
                }
                
                if (appState.equippedFrame.data.animated) {
                    profileFrame.classList.add('animated');
                }
            } else {
                profileFrame.style.border = 'none';
                profileFrame.classList.remove('animated');
            }
            
            // Имя и суффикс
            profileName.textContent = appState.user.first_name;
            if (appState.equippedSuffix) {
                usernameSuffix.textContent = appState.equippedSuffix.data.text;
                usernameSuffix.style.background = appState.equippedSuffix.data.color;
                usernameSuffix.classList.remove('hidden');
                
                if (appState.equippedSuffix.data.animated) {
                    usernameSuffix.classList.add('animated');
                } else {
                    usernameSuffix.classList.remove('animated');
                }
            } else {
                usernameSuffix.classList.add('hidden');
                usernameSuffix.classList.remove('animated');
            }
            
            // Титул
            profileTitle.textContent = appState.equippedTitle || 'Новичок';
            
            // ID
            profileId.textContent = `#${appState.playerId}`;
            
            // Статистика
            statLevel.textContent = appState.level;
            statCards.textContent = appState.cards.length;
            statCoins.textContent = appState.coins.toLocaleString();
            statUnique.textContent = [...new Set(appState.cards.map(c => c.id))].length;
            
            // Прогресс уровня
            currentLevel.textContent = appState.level;
            nextLevel.textContent = appState.level + 1;
            
            const expPercent = Math.min(100, (appState.exp / appState.expToNextLevel) * 100);
            levelFill.style.width = `${expPercent}%`;
            levelExp.textContent = `${appState.exp}/${appState.expToNextLevel} опыта`;
            
            // Любимая карта
            if (appState.favoriteCard) {
                favoriteCardImage.style.backgroundImage = `url('${appState.favoriteCard.image_path}')`;
                favoriteCardImage.innerHTML = '';
                favoriteCardName.textContent = appState.favoriteCard.name;
                favoriteCardRarity.textContent = appState.favoriteCard.rarityName;
                favoriteCardRarity.className = 'favorite-card-rarity';
                favoriteCardRarity.classList.add(`rarity-${appState.favoriteCard.rarity}`);
            } else {
                favoriteCardImage.style.backgroundImage = '';
                favoriteCardImage.innerHTML = '<i class="fas fa-heart" style="color: var(--text-secondary); font-size: 1.8rem;"></i>';
                favoriteCardName.textContent = 'Не выбрана';
                favoriteCardRarity.textContent = '—';
                favoriteCardRarity.className = 'favorite-card-rarity';
            }
        }

        // Обновление магазина
        function updateShop() {
            const shopTabs = document.querySelectorAll('.shop-tab');
            const shopContents = {
                packs: document.getElementById('packsTab'),
                personalization: document.getElementById('personalizationTab'),
                vip: document.getElementById('vipTab')
            };
            
            // Обработчики для вкладок магазина
            shopTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    shopTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    Object.values(shopContents).forEach(content => {
                        content.classList.add('hidden');
                    });
                    
                    const tabId = tab.dataset.tab + 'Tab';
                    if (shopContents[tab.dataset.tab]) {
                        shopContents[tab.dataset.tab].classList.remove('hidden');
                        renderShopTab(tab.dataset.tab);
                    }
                });
            });
            
            // Рендерим первую вкладку
            renderShopTab('packs');
        }

        function renderShopTab(tabName) {
            const items = CONFIG.SHOP_ITEMS[tabName];
            const container = document.getElementById(tabName + 'Tab');
            
            if (!items || !container) return;
            
            container.innerHTML = items.map(item => {
                const owned = checkIfOwned(item);
                const canBuy = (appState.coins >= item.price && !owned && item.price > 0) || 
                              (item.price === 0 && !owned);
                
                // Для товаров за звезды
                const priceDisplay = item.type === 'premium' ? `⭐ ${item.price}` : 
                                   item.type === 'vip' ? `${item.price.toLocaleString()} монет` :
                                   `${item.price} монет`;
                
                return `
                    <div class="shop-item" data-id="${item.id}">
                        <div class="shop-item-header">
                            <div class="shop-item-icon">
                                <i class="fas ${item.icon}"></i>
                            </div>
                            <div class="shop-item-title">
                                <div class="shop-item-name">${item.name}</div>
                                <div class="shop-item-desc">${item.description}</div>
                            </div>
                        </div>
                        
                        <div class="shop-item-price">
                            <i class="fas ${item.type === 'premium' ? 'fa-star' : 'fa-coins'}"></i>
                            ${priceDisplay}
                        </div>
                        
                        <button class="shop-item-btn ${owned ? 'owned' : ''} ${!canBuy ? 'disabled' : ''}" 
                                ${!canBuy ? 'disabled' : ''}
                                onclick="buyItem('${item.id}', '${tabName}')">
                            ${owned ? '✓ Куплено' : 'Купить'}
                        </button>
                    </div>
                `;
            }).join('');
        }

        // Покупка предмета в магазине
        function buyItem(itemId, category) {
            const item = CONFIG.SHOP_ITEMS[category].find(i => i.id === itemId);
            if (!item) return;
            
            // Проверка для товаров за монеты
            if (item.type !== 'premium' && appState.coins < item.price) {
                showNotification('Недостаточно монет', 'error');
                return;
            }
            
            // Проверка для товаров за звезды
            if (item.type === 'premium') {
                // Показываем модалку для покупки через звезды
                donatePremiumModal.classList.remove('hidden');
                return;
            }
            
            // Покупка за монеты
            appState.coins -= item.price;
            
            // Добавляем в инвентарь
            switch(item.type) {
                case 'suffix':
                    if (!appState.ownedItems.suffixes.includes(item.id)) {
                        appState.ownedItems.suffixes.push(item.id);
                        // Автоматически надеваем первый купленный суффикс
                        if (!appState.equippedSuffix) {
                            appState.equippedSuffix = item;
                        }
                    }
                    break;
                case 'frame':
                    if (!appState.ownedItems.frames.includes(item.id)) {
                        appState.ownedItems.frames.push(item.id);
                        // Автоматически надеваем первую купленную рамку
                        if (!appState.equippedFrame) {
                            appState.equippedFrame = item;
                        }
                    }
                    break;
                case 'vip':
                    const vipUntil = new Date();
                    vipUntil.setDate(vipUntil.getDate() + item.data.days);
                    appState.isVIP = true;
                    appState.vipUntil = vipUntil.toISOString();
                    break;
                case 'pack':
                    openShopPack(item);
                    break;
            }
            
            saveProfile();
            updateUI();
            updateShop();
            updateCustomization();
            updateProfile();
            
            showNotification(`"${item.name}" куплено!`, 'success');
        }

        // Обновление инвентаря кастомизации
        function updateCustomization(tab = 'suffixes') {
            // Обновляем счетчик
            const totalItems = appState.ownedItems.suffixes.length + 
                             appState.ownedItems.frames.length + 
                             appState.ownedItems.titles.length;
            totalCustomization.textContent = `${totalItems} предметов`;
            
            // Очищаем вкладки
            const containers = {
                suffixes: suffixesTab,
                frames: framesTab,
                titles: titlesTab
            };
            
            const container = containers[tab];
            if (!container) return;
            
            container.innerHTML = '';
            
            let items = [];
            switch(tab) {
                case 'suffixes':
                    items = CONFIG.SHOP_ITEMS.personalization.filter(item => item.type === 'suffix');
                    break;
                case 'frames':
                    items = CONFIG.SHOP_ITEMS.personalization.filter(item => item.type === 'frame');
                    break;
                case 'titles':
                    // Титулы из достижений
                    const levelTitles = Object.values(CONFIG.LEVEL_TITLES);
                    items = levelTitles.map((title, index) => ({
                        id: `title_${index}`,
                        name: title,
                        description: `Достигните уровня ${Object.keys(CONFIG.LEVEL_TITLES)[index] || '1'}`,
                        icon: 'fa-crown',
                        type: 'title',
                        data: { text: title }
                    }));
                    break;
            }
            
            if (items.length === 0) {
                container.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 40px 20px; color: var(--text-secondary);">
                        <i class="fas fa-tshirt" style="font-size: 3rem; margin-bottom: 15px;"></i>
                        <h3>Предметы не найдены</h3>
                        <p>Купите предметы в магазине</p>
                    </div>
                `;
                return;
            }
            
            items.forEach(item => {
                let owned = false;
                let equipped = false;
                
                switch(item.type) {
                    case 'suffix':
                        owned = appState.ownedItems.suffixes.includes(item.id);
                        equipped = appState.equippedSuffix && appState.equippedSuffix.id === item.id;
                        break;
                    case 'frame':
                        owned = appState.ownedItems.frames.includes(item.id);
                        equipped = appState.equippedFrame && appState.equippedFrame.id === item.id;
                        break;
                    case 'title':
                        owned = appState.ownedItems.titles.includes(item.name);
                        equipped = appState.equippedTitle === item.name;
                        break;
                }
                
                const itemElement = document.createElement('div');
                itemElement.className = 'customization-item';
                itemElement.dataset.id = item.id;
                
                let buttonText = 'Не куплено';
                let buttonClass = 'disabled';
                let clickHandler = null;
                
                if (owned) {
                    buttonText = equipped ? '✓ Надето' : 'Надеть';
                    buttonClass = equipped ? 'equipped' : '';
                    if (!equipped) {
                        clickHandler = () => equipCustomizationItem(item);
                    }
                }
                
                itemElement.innerHTML = `
                    <div class="customization-item-icon">
                        <i class="fas ${item.icon}"></i>
                    </div>
                    <div class="customization-item-name">${item.name}</div>
                    <div class="customization-item-desc">${item.description}</div>
                    <button class="customization-btn ${buttonClass}" 
                            ${!owned ? 'disabled' : ''}>
                        ${buttonText}
                    </button>
                `;
                
                // Обработчик кнопки
                const btn = itemElement.querySelector('.customization-btn');
                if (clickHandler) {
                    btn.addEventListener('click', clickHandler);
                }
                
                container.appendChild(itemElement);
            });
        }

        // Обновление лидерборда
        function updateLeaderboard(type = 'level') {
            const leaderboardList = document.getElementById('leaderboardList');
            if (!leaderboardList) return;
            
            const allPlayers = getAllUsers();
            const players = allPlayers.filter(player => !player.isAdmin);
            
            players.sort((a, b) => {
                switch(type) {
                    case 'level':
                        return b.level - a.level;
                    case 'cards':
                        return b.cards.length - a.cards.length;
                    case 'coins':
                        return b.coins - a.coins;
                    case 'unique':
                        const uniqueA = [...new Set(a.cards.map(c => c.id))].length;
                        const uniqueB = [...new Set(b.cards.map(c => c.id))].length;
                        return uniqueB - uniqueA;
                    default:
                        return b.level - a.level;
                }
            });
            
            const topPlayers = players.slice(0, 20);
            
            leaderboardList.innerHTML = topPlayers.map((player, index) => {
                const rank = index + 1;
                const uniqueCards = [...new Set(player.cards.map(c => c.id))].length;
                
                return `
                    <div class="leaderboard-item ${rank <= 3 ? 'top-3 rank-' + rank : ''}" onclick="showPlayerMiniProfile(${player.playerId})">
                        <div class="leaderboard-rank">${rank}</div>
                        <div class="leaderboard-avatar" style="background-image: url('${player.user.photo_url || ''}')"></div>
                        <div class="leaderboard-info">
                            <div class="leaderboard-name">
                                ${player.user.first_name}
                                ${player.equippedSuffix ? `<span class="username-suffix ${player.equippedSuffix.data.animated ? 'animated' : ''}" style="background: ${player.equippedSuffix.data.color}">${player.equippedSuffix.data.text}</span>` : ''}
                            </div>
                            <div class="leaderboard-stats">
                                <div class="leaderboard-stat">
                                    <i class="fas fa-star"></i>
                                    <span class="leaderboard-value">${player.level}</span>
                                    <span>ур.</span>
                                </div>
                                <div class="leaderboard-stat">
                                    <i class="fas fa-layer-group"></i>
                                    <span class="leaderboard-value">${player.cards.length}</span>
                                    <span>карт</span>
                                </div>
                                <div class="leaderboard-stat">
                                    <i class="fas fa-coins"></i>
                                    <span class="leaderboard-value">${player.coins.toLocaleString()}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            if (topPlayers.length === 0) {
                leaderboardList.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: var(--text-secondary);">
                        <i class="fas fa-trophy" style="font-size: 3rem; margin-bottom: 15px;"></i>
                        <h3>Лидерборд пуст</h3>
                        <p>Будьте первым в рейтинге!</p>
                    </div>
                `;
            }
            
            document.querySelectorAll('.leaderboard-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.leaderboard-tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    updateLeaderboard(tab.dataset.type);
                });
            });
        }

        // Обработка доната через Telegram Stars
        async function processCoinsDonation() {
            const selectedOption = donateCoinsModal.querySelector('.donate-option.selected');
            if (!selectedOption) return;
            
            const coins = parseInt(donateCoinsAmount.value) || 100;
            const method = selectedOption.dataset.method;
            const stars = Math.ceil(coins * 0.03);
            
            if (coins < 100) {
                showNotification('Минимальная покупка: 100 PepeCoins', 'error');
                return;
            }
            
            if (method === 'stars') {
                // Покупка через звезды Telegram
                try {
                    // Интеграция с Telegram Stars API
                    const result = await telegram.sendData(JSON.stringify({
                        action: 'buy_coins',
                        coins: coins,
                        stars: stars
                    }));
                    
                    if (result) {
                        appState.coins += coins;
                        saveProfile();
                        updateUI();
                        updateProfile();
                        showNotification(`Вы успешно купили ${coins} PepeCoins!`, 'success');
                        donateCoinsModal.classList.add('hidden');
                    } else {
                        showNotification('Ошибка оплаты. Попробуйте снова.', 'error');
                    }
                } catch (error) {
                    console.error('Ошибка оплаты:', error);
                    showNotification('Ошибка оплаты. Попробуйте снова.', 'error');
                }
            } else if (method === 'rubles') {
                telegram.showPopup({
                    title: 'Покупка через рубли',
                    message: `Напишите @DefoltPlayer для покупки ${coins} PepeCoins за ${Math.ceil(coins * 0.15)} ₽`,
                    buttons: [
                        { type: 'default', text: 'Открыть диалог' },
                        { type: 'cancel', text: 'Отмена' }
                    ]
                }, (buttonId) => {
                    if (buttonId === 'default') {
                        window.open('https://t.me/DefoltPlayer', '_blank');
                        showNotification('Напишите @DefoltPlayer для покупки PepeCoins');
                    }
                });
                donateCoinsModal.classList.add('hidden');
            }
        }

        async function processPremiumDonation() {
            const selectedOption = donatePremiumModal.querySelector('.donate-option.selected');
            if (!selectedOption) return;
            
            const method = selectedOption.dataset.method;
            
            if (method === 'stars') {
                // Покупка через звезды Telegram
                try {
                    const result = await telegram.sendData(JSON.stringify({
                        action: 'buy_premium',
                        stars: 200
                    }));
                    
                    if (result) {
                        const until = new Date();
                        until.setDate(until.getDate() + 30);
                        appState.isPremium = true;
                        appState.premiumUntil = until.toISOString();
                        saveProfile();
                        updateUI();
                        updateProfile();
                        showNotification('Вы успешно приобрели PepePremium на 30 дней! 👑', 'success');
                        donatePremiumModal.classList.add('hidden');
                    } else {
                        showNotification('Ошибка оплаты. Попробуйте снова.', 'error');
                    }
                } catch (error) {
                    console.error('Ошибка оплаты:', error);
                    showNotification('Ошибка оплаты. Попробуйте снова.', 'error');
                }
            } else if (method === 'rubles') {
                telegram.showPopup({
                    title: 'Покупка через рубли',
                    message: 'Напишите @DefoltPlayer для покупки PepePremium за 100 ₽',
                    buttons: [
                        { type: 'default', text: 'Открыть диалог' },
                        { type: 'cancel', text: 'Отмена' }
                    ]
                }, (buttonId) => {
                    if (buttonId === 'default') {
                        window.open('https://t.me/DefoltPlayer', '_blank');
                        showNotification('Напишите @DefoltPlayer для покупки PepePremium');
                    }
                });
                donatePremiumModal.classList.add('hidden');
            }
        }

        // Админ функции
        function updateAdminPanel() {
            if (appState.adminSelectedPlayer) {
                adminCurrentPlayer.textContent = `#${appState.adminSelectedPlayer.playerId} (${appState.adminSelectedPlayer.user.first_name})`;
                adminPlayerInfo.classList.remove('hidden');
                
                // Обновляем информацию об игроке
                adminPlayerName.textContent = appState.adminSelectedPlayer.user.first_name;
                adminPlayerLevel.textContent = appState.adminSelectedPlayer.level;
                adminPlayerCoins.textContent = appState.adminSelectedPlayer.coins.toLocaleString();
                adminPlayerCards.textContent = appState.adminSelectedPlayer.cards.length;
                adminPlayerUnique.textContent = [...new Set(appState.adminSelectedPlayer.cards.map(c => c.id))].length;
                adminPlayerPremium.textContent = appState.adminSelectedPlayer.isPremium ? 'Да' : 'Нет';
                adminPlayerVIP.textContent = appState.adminSelectedPlayer.isVIP ? 'Да' : 'Нет';
                
                const lastCardTime = appState.adminSelectedPlayer.lastCardTime;
                if (lastCardTime) {
                    const date = new Date(lastCardTime * 1000);
                    adminPlayerLastCard.textContent = date.toLocaleString();
                } else {
                    adminPlayerLastCard.textContent = 'Никогда';
                }
            } else {
                adminCurrentPlayer.textContent = 'Не выбран';
                adminPlayerInfo.classList.add('hidden');
            }
        }

        function searchPlayer() {
            const searchId = adminPlayerId.value.trim();
            if (!searchId) {
                showNotification('Введите ID игрока', 'error');
                return;
            }
            
            let foundPlayer = null;
            
            // Поиск по ID игрока (#123)
            if (searchId.startsWith('#')) {
                const playerId = parseInt(searchId.substring(1));
                foundPlayer = findUserByPlayerId(playerId);
            }
            // Поиск по Telegram ID
            else if (!isNaN(searchId)) {
                const telegramId = parseInt(searchId);
                foundPlayer = findUserByTelegramId(telegramId);
            }
            
            if (foundPlayer) {
                appState.adminSelectedPlayer = foundPlayer;
                updateAdminPanel();
                showNotification(`Игрок найден: #${foundPlayer.playerId} (${foundPlayer.user.first_name})`, 'success');
            } else {
                showNotification('Игрок не найден', 'error');
            }
        }

        function toggleMaintenance() {
            maintenanceMode = !maintenanceMode;
            localStorage.setItem('pepecards_maintenance', maintenanceMode.toString());
            
            if (maintenanceMode) {
                // Не показываем оверлей админу
                if (!appState.isAdmin) {
                    maintenanceOverlay.classList.remove('hidden');
                }
                showNotification('Технический перерыв включен', 'success');
                updateCooldown();
            } else {
                maintenanceOverlay.classList.add('hidden');
                showNotification('Технический перерыв выключен', 'success');
                updateCooldown();
            }
        }

        // Обработка открытия карты с гарантированной анимацией
        async function openRandomCard() {
            if (maintenanceMode && !appState.isAdmin) {
                showNotification('Технический перерыв. Попробуйте позже.', 'error');
                return;
            }
            
            const now = Math.floor(Date.now() / 1000);
            
            if (!appState.isAdmin) {
                // Проверка кулдауна для обычных пользователей
                let cooldown;
                
                if (appState.isPremium) {
                    cooldown = CONFIG.COOLDOWN_PREMIUM;
                } else if (appState.isVIP) {
                    cooldown = CONFIG.COOLDOWN_VIP;
                } else {
                    cooldown = CONFIG.COOLDOWN_NORMAL;
                }
                
                if (now - appState.lastCardTime < cooldown) {
                    showNotification('Подождите перед открытием следующей карты!', 'error');
                    return;
                }
            }
            
            appState.lastCardTime = now;
            
            // Получаем случайную карту
            const card = getRandomCard();
            
            // Добавляем карту в коллекцию
            const cardCopy = { ...card, obtained: new Date().toISOString() };
            appState.cards.push(cardCopy);
            
            // Добавляем награды с учетом бонусов
            let coins = card.coins;
            let exp = card.exp;
            
            if (appState.isPremium) {
                coins = Math.floor(coins * 1.5);
                exp = Math.floor(exp * 1.5);
            } else if (appState.isVIP) {
                coins = Math.floor(coins * 1.25);
                exp = Math.floor(exp * 1.25);
            }
            
            appState.coins += coins;
            appState.exp += exp;
            
            // Проверяем повышение уровня
            const leveledUp = checkLevelUp();
            
            // Сохраняем изменения
            saveProfile();
            
            // Всегда показываем анимацию с задержкой
            setTimeout(() => {
                showCardRevealAnimation(card, coins, exp, leveledUp);
            }, 100);
            
            // Обновляем UI
            updateUI();
            updateInventory();
            updateProfile();
            
            // Звуковое уведомление
            if (telegram && telegram.HapticFeedback) {
                telegram.HapticFeedback.impactOccurred('medium');
            }
        }

        // Показ анимации получения карты
        function showCardRevealAnimation(card, coins, exp, leveledUp) {
            // Всегда сбрасываем анимацию
            revealCard.classList.remove('flipped');
            revealCardImage.style.backgroundImage = `url('${card.image_path}')`;
            revealCardName.textContent = card.name;
            revealCardRarity.textContent = card.rarityName;
            revealCardRarity.className = 'reveal-card-rarity';
            revealCardRarity.classList.add(`rarity-${card.rarity}`);
            
            // Создаем отображение наград
            revealRewards.innerHTML = `
                <div class="reveal-reward">
                    <div class="reveal-reward-icon"><i class="fas fa-coins"></i></div>
                    <div class="reveal-reward-value">+${coins.toLocaleString()}</div>
                    <div class="reveal-reward-label">Монеты</div>
                </div>
                <div class="reveal-reward">
                    <div class="reveal-reward-icon"><i class="fas fa-star"></i></div>
                    <div class="reveal-reward-value">+${exp.toLocaleString()}</div>
                    <div class="reveal-reward-label">Опыт</div>
                </div>
                ${leveledUp ? `
                <div class="reveal-reward">
                    <div class="reveal-reward-icon"><i class="fas fa-level-up-alt"></i></div>
                    <div class="reveal-reward-value">${appState.level}</div>
                    <div class="reveal-reward-label">Уровень!</div>
                </div>
                ` : ''}
            `;
            
            // Показываем модалку
            cardRevealModal.classList.remove('hidden');
            
            // Запускаем анимацию переворота с задержкой
            setTimeout(() => {
                revealCard.classList.add('flipped');
                
                // Создаем конфетти для редких карт
                if (card.rarity === 'legendary' || card.rarity === 'mythic' || card.rarity === 'secret') {
                    createConfetti();
                }
                
                // Автоматическое скрытие
                setTimeout(() => {
                    cardRevealModal.classList.add('hidden');
                    
                    // Показываем уведомление о новой карте
                    if (card.rarity === 'secret') {
                        showNotification('🎉 НЕВЕРОЯТНО! Вы нашли СЕКРЕТНУЮ карту! 🎉', 'success');
                    } else if (card.rarity === 'mythic') {
                        showNotification('🔥 Вы получили МИФИЧЕСКУЮ карту!', 'success');
                    } else if (card.rarity === 'legendary') {
                        showNotification('⭐ Вы получили ЛЕГЕНДАРНУЮ карту!', 'success');
                    } else {
                        showNotification(`Вы получили карту: ${card.name}`, 'success');
                    }
                }, 4000);
            }, 500); // Задержка перед переворотом
        }

        // Инициализация приложения при загрузке DOM
        document.addEventListener('DOMContentLoaded', initApp);

        // Глобальные функции для использования в HTML
        window.buyItem = buyItem;
        window.showPlayerMiniProfile = showPlayerMiniProfile;
    </script>
</body>
</html>
